<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scorepage</title>
    <style>
        /* Font declarations with fallbacks and proper format */
        @font-face {
            font-family: 'Nutmeg';
            src: url('./internalAssets/Nutmeg/Nutmeg/Nutmeg-Black copy.otf') format('opentype');
            font-display: swap;
        }
        @font-face {
            font-family: 'Bangers';
            src: url('./internalAssets/bangersDanfo/Bangers/Bangers-Regular.ttf') format('truetype');
            font-display: swap;
        }
        @font-face {
            font-family: 'Aldrich';
            src: url('./internalAssets/Aldrich/Aldrich-Regular.ttf') format('truetype');
            font-display: swap;
        }
        @font-face {
            font-family: 'DigitalT';
            src: url('./internalAssets/digitalt/Digitalt.ttf') format('truetype');
            font-display: swap;
        }
    
        body {
            background-image: url(./internalAssets/Pattern\ placeholder.gif);
            background-color: #714882;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .scores {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .positionDiv {
            font-family: 'DigitalT', 'Arial', sans-serif;
            padding: 10px;
            margin: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-left: 2rem;
            position: relative;
        }
        
        /* First place styling */
        #first-place-player-name {
            font-size: 80px;
            font-weight: bold;
            position: relative;
            left: 12%;
            bottom: 51%;
            color: gold;
            padding-left: 8rem;
            max-width: 33rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            text-align: left;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        #first-place-player-score {
            font-size: 80px;
            font-weight: bold;
            position: relative;
            left: 34%;
            bottom: 54%;
            color: gold;
            padding-left: 5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        /* Second place styling */
        #second-place-player-name {
            font-size: 55px;
            font-weight: bold;
            position: absolute;
            left: 14%;
            bottom: 35%;
            color: silver;
            padding-left: 8rem;
            max-width: 35rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            text-align: left;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        #second-place-player-score {
            font-size: 80px;
            font-weight: bold;
            position: absolute;
            left: 33%;
            bottom: 33%;
            color: silver;
            padding-left: 5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        /* Third place styling */
        #third-place-player-name {
            font-size: 45px;
            font-weight: bold;
            position: absolute;
            left: 16%;
            bottom: 20%;
            color: rgb(165, 85, 42);
            padding-left: 8rem;
            max-width: 27rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            text-align: left;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        #third-place-player-score {
            font-size: 70px;
            font-weight: bold;
            position: absolute;
            left: 31%;
            bottom: 18%;
            color: rgb(165, 85, 42);
            padding-left: 5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        /* Leaderboard title */
        #leaderboard-title {
            font-family: 'Bangers', 'Impact', sans-serif;
            font-size: 160px;
            font-weight: bold;
            position: absolute;
            top: 9%;
            left: 15%;
            margin: 10px;
            color: white;
            z-index: 13;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5);
        }
        
        /* Floor div */
        #floorDiv {
            background-color: #615785;
            width: 100%;
            height: 700px;
            position: absolute;
            bottom: 0%;
            left: 0;
            z-index: -10;
        }
        
        /* Player score section */
        #playerScore {
            background-color: rgba(12, 0, 66, 0.8);
            border-radius: 25px;
            width: 950px;
            height: 400px;
            left: 60%;
            top: 20%;
            position: absolute;
            z-index: 10;
            color: #fff;
            transform: translateX(-50%);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        #playerPosition {
            font-family: 'DigitalT', 'Arial', sans-serif;
            padding-left: 60px;
            padding-right: 60px;
            padding-top: 10%;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        #your-player-name {
            font-size: 36px;
            font-weight: bold;
            position: absolute;
            left: 15%;
            padding-left: 8rem;
            max-width: 27rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            text-align: left;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        #your-player-score {
            font-size: 50px;
            font-weight: bold;
            position: absolute;
            left: 76%;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        #individual-playerPlace {
            position: absolute;
            left: 80px;
            font-size: 30px;
            color: #fff;
            padding-left: 4rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        /* Images */
        #chars {
            position: absolute;
            width: 900px;
            bottom: 15%;
            left: 60%;
            max-width: 100%;
            height: auto;
        }
        
        #lead {
            position: absolute;
            width: 1500px;
            bottom: 15%;
            right: 48%;
            max-width: 100%;
            height: auto;
        }
        
        #boardPic {
            position: absolute;
            width: 1500px;
            top: 5%;
            left: 5%;
            max-width: 100%;
            height: auto;
        }
        
        #playerScoreTitle {
            font-family: 'Bangers', 'Impact', sans-serif;
            font-size: 80px;
            font-weight: bold;
            text-align: center;
            margin: 10px;
            padding-top: 20px;
            padding-bottom: 0px;
            border-bottom: 2px solid #615785;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* Media queries for responsiveness */
        @media (max-width: 1200px) {
            #leaderboard-title {
                font-size: 120px;
                top: 5%;
                left: 10%;
            }
            
            #playerScore {
                width: 80%;
                left: 50%;
            }
            
            #first-place-player-name, #first-place-player-score,
            #second-place-player-name, #second-place-player-score,
            #third-place-player-name, #third-place-player-score {
                font-size: 60px;
            }
        }
        
        @media (max-width: 768px) {
            #leaderboard-title {
                font-size: 80px;
                top: 3%;
                left: 5%;
            }
            
            #playerScore {
                width: 90%;
                height: 300px;
            }
            
            #playerScoreTitle {
                font-size: 60px;
            }
            
            #first-place-player-name, #first-place-player-score {
                font-size: 40px;
            }
            
            #second-place-player-name, #second-place-player-score {
                font-size: 35px;
            }
            
            #third-place-player-name, #third-place-player-score {
                font-size: 30px;
            }
            
            #your-player-name {
                font-size: 28px;
                left: 10%;
                padding-left: 4rem;
            }
            
            #your-player-score {
                font-size: 36px;
                left: 70%;
            }
        }
    </style>
</head>
<body>
    <h1 id="leaderboard-title">Leaderboard</h1>
    <img id="boardPic" src="./internalAssets/bigTxt.png" alt="Board Background">
    
    <div id="scoreboard_bg">
        <div class="scores">
            <div class="positionDiv">
                <img id="lead" src="./internalAssets/leaderboard.png" alt="Leaderboard Background">
                <!-- First place -->
                <p id="first-place-player-name">Majestic Mountaineers</p>
                <p id="first-place-player-score">$ 100</p>
            </div>
            <div class="positionDiv">
                <!-- Second place -->
                <p id="second-place-player-name">Cosmic Cosmonauts</p>
                <p id="second-place-player-score">$ 90</p>
            </div>
            <div class="positionDiv">
                <!-- Third place -->
                <p id="third-place-player-name">Slimy Adventurers</p>
                <p id="third-place-player-score">$ 80</p>
            </div>
        </div>
    </div>
    
    <div id="playerScore">
        <h1 id="playerScoreTitle">Your Score</h1>
        <div id="playerPosition">
            <img id="playerPositionImg" src="./internalAssets/bigTxt.png" alt="Player Position Background">
            <h1 id="individual-playerPlace">X</h1>
            <p id="your-player-name">Kickin Rocketeers</p>
            <p id="your-player-score">$ 50</p>
        </div>
    </div>
    
    <div id="floorDiv">
        <img id="chars" src="./internalAssets/character group.png" alt="Characters">
    </div>

    <script>
        // Function to check if fonts are loaded
        document.fonts.ready.then(function() {
            console.log("All fonts are loaded!");
            // You could add a class to the body when fonts are loaded
            document.body.classList.add('fonts-loaded');
        });

        // Fetch the leaderboard data from the server
        fetch('/leaderboard/all')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                console.log('Leaderboard data:', data); // Log the data to see its structure

                const teams = data;

                // Sort the teams based on score in descending order
                teams.sort((a, b) => b.score - a.score);

                // Get the top 3 teams
                const topTeams = teams.slice(0, 3);
                console.log('Top 3 teams:', topTeams); // Log the top teams to see their names and scores

                // Update the HTML with the top teams' names and scores
                topTeams.forEach((team, index) => {
                    let position;
                    if (index === 0) {
                        position = "first";
                    } else if (index === 1) {
                        position = "second";
                    } else if (index === 2) {
                        position = "third";
                    }
                    
                    const playerNameElement = document.getElementById(`${position}-place-player-name`);
                    const playerScoreElement = document.getElementById(`${position}-place-player-score`);
                    
                    if (playerNameElement && playerScoreElement) {
                        playerNameElement.innerHTML = team.name;
                        playerScoreElement.innerHTML = `$ ${team.score}`;
                    }
                });

                // Find the current player's team in the leaderboard
                // This assumes you have a way to identify the current player's team
                // You might need to adjust this logic based on your application
                const currentTeamName = sessionStorage.getItem("teamName"); // Default to "Kickin Rocketeers" if not set
                console.log('Current team name:', currentTeamName); // Log the current team name
                const currentTeam = teams.find(team => team.name === currentTeamName);
                
                if (currentTeam) {
                    const currentTeamIndex = teams.findIndex(team => team.name === currentTeamName);
                    document.getElementById("your-player-name").innerHTML = currentTeam.name;
                    document.getElementById("your-player-score").innerHTML = `$ ${currentTeam.score}`;
                    document.getElementById("individual-playerPlace").innerHTML = (currentTeamIndex + 1).toString();
                }
            })
            .catch(error => {
                console.error('Error fetching leaderboard data:', error);
                // Display a fallback message if data can't be loaded
                document.getElementById("leaderboard-title").textContent = "Leaderboard (Offline)";
            });
    </script>
</body>
</html>