
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial Level</title>
  <style>
   * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    @font-face {
      font-family: 'Nutmeg';
      src: url('./internalAssets/Nutmeg/Nutmeg/Nutmeg-Black\ copy.otf');
    }
    @font-face {
            font-family: 'Bangers';
            src: url('./internalAssets/bangersDanfo/Bangers/Bangers-Regular.ttf');
        }
        @font-face {
            font-family: 'DigitalT';
            src: url('./internalAssets/digitalt/Digitalt.ttf');
        }
        @font-face {
            font-family: 'Aldrich';
            src: url('./internalAssets/Aldrich/Aldrich-Regular.ttf');
        }

        body {
      background-color: #714882;
      background-size: cover;
      background-repeat: no-repeat; 
      height: 100vh;
      overflow: hidden;
      position: relative;
      font-family: Bangers, sans-serif;
    }

    #quiz-question {
      position: absolute;
      top: 19%;
      left: 5%;
      width: 60%;
      
    }

    #questBoard {
      width: 100%;
      position: relative;
      z-index: 1;
      transform: scaleX(-1);
    }

    #questMess {
      font-family: 'Bangers', sans-serif;
      font-size: 70px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
      color: whitesmoke;
      text-align: center;
      width: 80%;
      padding-left: 8rem;
        max-width: 90rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
        text-align: center;
        
    }

    #money {
      position: absolute;
      bottom: 53.5%;
      right: 18%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #star{
      position: absolute;
      bottom: 36.3%;
      right: 15.8%;
      z-index: 9;
      width: 140px;
  height: 140px;   
   /* Set a fixed height to match width */
  object-fit: contain;
    }


    #moneyTxt {
      font-family: Nutmeg, sans-serif;
      position: absolute;
      font-size: 60px;
      color: black;
      z-index: 2;
    }

    #hintBubble {
    position: absolute;
    top: 5%;
    left: 82%; /* Center horizontally */
    transform: translateX(-50%);
    padding: 20px 40px; /* Reduced vertical padding, increased horizontal padding */
    background-color: #fff;
    border-radius: 20px; /* More oval shape */
    border: 2px solid #ccc;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    z-index: 40;
    text-align: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    max-width: 60%; /* Wider maximum width */
    min-width: 400px; /* Ensure minimum width */
    word-wrap: break-word;
    display: flex;
    flex-direction: row; /* Changed to row for horizontal layout */
    align-items: center;
    justify-content: center;
  }

  #hintBubble::after {
    content: '';
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-width: 20px;
    border-style: solid;
    border-color: #fff transparent transparent transparent;
  }

  #hintTxt {
    font-family: Aldrich, sans-serif;
    font-size: 28px; /* Slightly smaller font for better horizontal fit */
    line-height: 1.3;
    color: #000;
    margin: 0;
    padding: 0;
    text-align: center;
    transition: opacity 0.3s ease;
    max-width: 100%; /* Use full width of the container */
    word-wrap: break-word;
    overflow-wrap: break-word;
  }
  #hintBubble.show {
      opacity: 1;
    }

    #Zilby {
      position: absolute;
      right: 9%;
      bottom: 48%;
      width: 550px;
    }

    #Zilby img {
      width: 100%;
    }

    #podium {
      position: absolute;
      left: 73%;
      bottom: 34%;
      width: 550px;
      text-align: center;
    }

    #podium img {
      width: 100%;
    }

    #timer {
      position: absolute;
      left: 6.5%;
      top: -3%;
      width: 400px;
      text-align: center;
      z-index: 5;
    }

    #timer img {
      width: 100%;
    }

    #timer h2 {
      font-family: Nutmeg, sans-serif;
      position: absolute;
      top: 65%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 50px;
      z-index: 2;
    }

    #quiz-options {
      position: absolute;
      bottom: 0%;
      left: 0;
      width: 100%;
      height: 600px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 20px;
      background-color: #2c1f65;
      z-index: 10;
    }

    #quiz-options button {
      font-family: DigitalT, sans-serif;
      margin: 50px;
      padding: 15px 30px;
      font-size: 58px;
      border-radius: 25px; /* More rounded corners */
      align-content: center;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;     
      width: 20%;
      top: 10%;
      color: whitesmoke;
      position: relative;
      /* Bubbly effect with box shadow and border */
      box-shadow: 0 8px 0 rgba(0, 0, 0, 0.3), 0 15px 20px rgba(0, 0, 0, 0.3);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      /* 3D effect with transform */
      transform-style: preserve-3d;
      transform: perspective(500px) rotateX(5deg);
      align-items: center;

      /* New styles for layout */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      height: 70%; /* Set a fixed height for consistency */
      padding-top: 170px; /* Add more padding at the top for the text */
      padding-bottom: 120px; /* Add more padding at the bottom for the image */
    }

    #quiz-options button:hover {
      background-color: #f0f0f0;
      color: black;
      transform: perspective(500px) rotateX(5deg) scale(1.05);
      box-shadow: 0 12px 0 rgba(0, 0, 0, 0.2), 0 18px 25px rgba(0, 0, 0, 0.4);
    }

    #quiz-options button:active {
      transform: perspective(500px) rotateX(5deg) scale(0.98) translateY(5px);
      box-shadow: 0 4px 0 rgba(0, 0, 0, 0.3), 0 8px 12px rgba(0, 0, 0, 0.3);
    }

    #optionA {
      background-color: #DC3A3A;
      background-image: linear-gradient(to bottom, #FF5252, #DC3A3A);
    }

    #optionB {
      background-color: #26549D;
      background-image: linear-gradient(to bottom, #3A7BD5, #26549D);
    }

    #optionC {
      background-color: #699215;
      background-image: linear-gradient(to bottom, #8BC34A, #699215);
    }

    #optionD {
      background-color: #F1A327;
      background-image: linear-gradient(to bottom, #FFD54F, #F1A327);
    }

    #quiz-options button img {
      /* width: 90px; */
      position: absolute;
      bottom: 75%;
      left:-5%;
      width: 21%;
      height: auto;
      filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.5));
      text-align: center;
    }

    /* Correct answer style - enhanced for better visibility */
    .selected {
      background-color: #28a745 !important;
      background-image: linear-gradient(to bottom, #34ce57, #28a745) !important;
      color: white !important;
      border: 3px solid #155724 !important;
      box-shadow: 0 0 20px rgba(40, 167, 69, 0.9) !important;
      animation: pulse 1.5s infinite !important;
      opacity: 1 !important;
      transform: perspective(500px) rotateX(5deg) scale(1.05) !important;
      z-index: 20 !important;
    }

    /* Animation for the correct answer */
    @keyframes pulse {
      0% {
        box-shadow: 0 0 10px rgba(40, 167, 69, 0.7);
      }
      50% {
        box-shadow: 0 0 20px rgba(40, 167, 69, 1);
      }
      100% {
        box-shadow: 0 0 10px rgba(40, 167, 69, 0.7);
      }
    }

    /* Incorrect answer style */
    .incorrect {
      background-color: #564849 !important;
      background-image: linear-gradient(to bottom, #381b18, #dc3545) !important;
      opacity: 0.8 !important;
      color: white !important;
      border: 2px solid #4b272a !important;
      box-shadow: 0 0 10px rgba(220, 53, 69, 0.7) !important;
    }

    /* Grey out non-selected and non-incorrect options */
    .greyed {
      background-color: #6c757d !important;
      background-image: linear-gradient(to bottom, #868e96, #6c757d) !important;
      opacity: 0.5 !important;
      color: #e0e0e0 !important;
      transform: perspective(500px) rotateX(5deg) scale(0.95) !important;
      transition: all 0.3s ease !important;
    }

    /* Optional: Add a highlight effect when an option is clicked */
    .quiz-button:active {
      transform: perspective(500px) rotateX(5deg) scale(0.98) translateY(5px);
      transition: transform 0.1s ease;
    }
    #backgroundVideo {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: -1; /* Ensure it stays behind other elements */
    }

  #sButt:hover {
    cursor: pointer;
  }
  </style>

<audio id="crr" src="./audio/CorrectAnswerWIP1.mp3"></audio>
<audio id="wr" src="./audio/WrongAnswerWIP1.mp3"></audio>
<audio id="mding" src="./audio/MoneyDingWIP1.mp3"></audio>
<audio id="failT" src="./audio/FailureTuneWIP1.mp3"></audio>
<audio id="menuBoop" src="./audio/MenuButtonWIP1.mp3"></audio>
</head>

<body>

  <video id="backgroundVideo" autoplay muted loop>
    <source src="./internalAssets/stars-long(1).mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <div id="timer">
    
    <img src="./internalAssets/newTimeTv.png" alt="Timer">
    <h2 id="timerTxt">00:00</h2>
  </div>

  <div id="quiz-question">
    <h1 id="questMess">What is our host's name?</h1>
    <video id="questBoard" autoplay loop>
      <source src="./internalAssets/QuestionSign-Idle.webm" type="video/webm">
      <!-- <source src="./internalAssets/QuestionSign-Correct.webm" type="video/webm"> -->
       <!-- <source src="./internalAssets/QuestionSign-Incorrect.webm" type="video/webm"> -->
  </video>
  </div>

  <div id="money">
    <h2 id="moneyTxt">$0</h2>
  </div>
  <img id="star" src="./internalAssets/podiumCash.svg" alt="Money">

  <div id="hintBubble">
    <h2 id="hintTxt">This is a hint</h2>
  </div>

  <div id="Zilby">
    <img id="zilbee" src="./internalAssets/ZilbyIdle.gif" alt="Zilby">
  </div>

  <div id="podium">
    <img src="./internalAssets/newSickPodium.png" alt="Podium">
  </div>

  

  <div id="quiz-options" >
    <button id="optionA" class="quiz-button" data-answer="A">
      Erin
      <img id="A_Button" src="./internalAssets/A_Button_icon.png" alt="A Button">
    </button>
    <button id="optionB" class="quiz-button" data-answer="B">
      Glimmy
      <img id="B_Button" src="./internalAssets/B_Button_icon.png" alt="B Button">
    </button>
    <button id="optionC" class="quiz-button" data-answer="C">
      Zilby
      <img id="C_Button" src="./internalAssets/C_Button_icon.png" alt="C Button">
    </button>
    <button id="optionD" class="quiz-button" data-answer="D">
      Bob
      <img id="D_Button" src="./internalAssets/D_Button_icon.png" alt="D Button">
    </button>
    
  </div>

  <script>
    // Game state
    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let selectedEra = sessionStorage.getItem('selectedEra') || 'discoEra';
    let difficulty = 'easy'; // Default to easy questions
    let timerInterval = null;
    let timeLeft = 30; // Default timer value in seconds

    // DOM elements
    const questionElement = document.getElementById('questMess');
    const optionsElement = document.getElementById('quiz-options');
    const moneyElement = document.getElementById('moneyTxt');
    const hintBubbleElement = document.getElementById('hintTxt');
    const timerElement = document.getElementById('timerTxt');
    const optionButtons = document.querySelectorAll('.quiz-button');
    const zilbyImg = document.getElementById('zilbee');
    const correctAudio = document.getElementById('crr');
    const wrongAudio = document.getElementById('wr');
    const moneySound = document.getElementById('mding');
    const failSound = document.getElementById('failT');
    const menuPop = document.getElementById('menuBoop');
    const board = document.getElementById('questBoard');

    // Sample questions for testing (replace with your actual questions)
    const sampleQuestions = {
      "question1": {
        "question": "What is the host's name?",
        "options": ["Erin", "Glimmy", "Zilby", "Bob"],
        "answer": "C",
        "hint": "I mean... I sure do HOPE you know my name!",
        "points": 100
      }
    };

    // WebSocket connection
    let ws;
    try {
      ws = new WebSocket('ws://localhost:3000');
      
      ws.onopen = () => {
        console.log('WebSocket connection established');
      };
      
      ws.onmessage = (event) => {
        const message = event.data;
        console.log(`Button Pressed: "${message}"`);
        handleButtonPress(message);
      };
      
      ws.onerror = (error) => {
        console.error('WebSocket error:', error);
      };
      
      ws.onclose = () => {
        console.log('WebSocket connection closed');
      };
    } catch (error) {
      console.error('Failed to create WebSocket connection:', error);
    }

    // Function to handle button press from WebSocket
    function handleButtonPress(message) {
      // Expected format: "Button A pressed"
      const match = message.match(/Button\s+([A-Z])\s+pressed/i);
      if (match && match[1]) {
        const letter = match[1].toUpperCase(); // e.g., "A"
        const buttonId = `option${letter}`;    // e.g., "optionA"
        console.log(`Mapping message "${message}" to button ID "${buttonId}"`);
        const button = document.getElementById(buttonId);
        if (button) {
          button.click();
        } else {
          console.log(`Button with ID ${buttonId} not found.`);
        }
      } else {
        console.log(`Message does not match expected format: "${message}"`);
      }
    }

    // Add event listeners to option buttons
    optionButtons.forEach(button => {
      button.addEventListener('click', function() {
        const selectedOption = this.getAttribute('data-answer');
        const correctAnswer = Object.values(currentQuestions)[currentQuestionIndex].answer;
        selectOption(this, selectedOption, correctAnswer);
      });
    });

    // Handle option selection
    function selectOption(optionElement, selectedOption, correctAnswer) {
      // Clear any existing timer
      clearInterval(timerInterval);
      
      // Disable all option buttons
      document.querySelectorAll('.quiz-button').forEach(button => {
        button.disabled = true;
      });

      // Check correctness and update score
      if (selectedOption === correctAnswer) {
        optionElement.classList.add('selected'); // Correct answer
        score += Object.values(currentQuestions)[currentQuestionIndex].points;
        hintBubbleElement.textContent = "Correct answer!";
        correctAudio.play().catch(error => console.error('Correct audio playback error:', error));
        moneySound.play().catch(error => console.error('Money sound playback error:', error));
        board.src = './internalAssets/QuestionSign-Correct.webm';
        zilbyImg.src ='./internalAssets/ZilbyReacts-Correct.gif'
      } else {
        optionElement.classList.add('incorrect'); // Incorrect answer
        // Find and highlight the correct answer
        document.querySelectorAll('.quiz-button').forEach(button => {
          if (button.getAttribute('data-answer') === correctAnswer) {
            button.classList.add('selected'); // Mark the correct option
          }
        });
        hintBubbleElement.textContent = "Yikes... Well this is awkward";
        board.src = './internalAssets/QuestionSign-Incorrect.webm';
        zilbyImg.src = './internalAssets/ZilbyReacts-Incorrect.gif';
        wrongAudio.play();
        
      }

      // Grey out all options that are not marked as selected/incorrect
      document.querySelectorAll('.quiz-button').forEach(button => {
        if (!button.classList.contains('selected') && !button.classList.contains('incorrect')) {
          button.classList.add('greyed');
          
          
        }
      });

      // Update the money score
      moneyElement.textContent = `$${score}`;

      // Move to the next question automatically after 3 seconds
      setTimeout(() => {
        resetButtonStyles();
        currentQuestionIndex++;
        if (currentQuestionIndex >= Object.keys(currentQuestions).length) {
          endGame();
        } else {
          displayQuestion();
        }
      }, 3000); // Wait 3 seconds before moving to the next question
    }

    // Reset button styles for the next question
    function resetButtonStyles() {
      document.querySelectorAll('.quiz-button').forEach(button => {
        button.classList.remove('selected', 'incorrect', 'greyed');
        button.disabled = false;
        board.src = './internalAssets/QuestionSign-Idle.webm';
        zilbyImg.src = './internalAssets/ZilbyIdle.gif';
      });
    }

    // End the game
    function endGame() {questionElement.textContent = `Tutorial Over! Your final score is: $${score}`;
      
      // Create styled end message with centered text and proper icon sizing
      optionsElement.innerHTML = `
        <div id="sButt" style="text-align: center; width: 100%; font-size: 90px; color: #fdb813; display: flex; justify-content: center; align-items: center; flex-direction: column; margin-top: 20px;">
          Press <span style="display: inline-block; vertical-align: middle; margin: 0 10px;">
            <img src="./internalAssets/S Button icon.png" style="width: 70px; vertical-align: middle;">
          </span> to continue to era selection
          <br>
        </div>
      `;
      
      hintBubbleElement.textContent = "Well alright! Let's move on!";
      clearInterval(timerInterval);

      // s button to continue to era selection
      document.getElementById('sButt').addEventListener('click', function() {
        menuPop.play();
        window.location.href = 'difficult.html';
      });
      
      // Add event listeners for S and F keys
      document.addEventListener('keydown', function(event) {
        if (event.key.toLowerCase() === 'E') {
          menuPop.play();
          window.location.href = 'difficult.html';
        }
      });
      
      // Update WebSocket handler to handle S and F button presses
      ws.onmessage = (event) => {
        const message = event.data;
        if (message.includes('Button E pressed')) {
          window.location.href = 'difficult.html';
        }
      };
    }

    // Start the timer
    function startTimer(seconds) {
      timeLeft = seconds;
      updateTimerDisplay();
      
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          // Time's up - move to next question
          hintBubbleElement.textContent = "Time's up!";
          
          // Show the correct answer
          const correctAnswer = Object.values(currentQuestions)[currentQuestionIndex].answer;
          document.querySelectorAll('.quiz-button').forEach(button => {
            if (button.getAttribute('data-answer') === correctAnswer) {
              button.classList.add('selected');
            } else {
              button.classList.add('greyed');
            }
            button.disabled = true;
          });
          
          setTimeout(() => {
            resetButtonStyles();
            currentQuestionIndex++;
            if (currentQuestionIndex >= Object.keys(currentQuestions).length) {
              endGame();
            } else {
              displayQuestion();
            }
          }, 2000);
        }
      }, 1000);
    }

    // Update the timer display
    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // Display the current question
    function displayQuestion() {
      const currentQuestion = Object.values(currentQuestions)[currentQuestionIndex];
      questionElement.textContent = currentQuestion.question;
      
      // Update options
      const options = currentQuestion.options;
      document.getElementById('optionA').textContent = options[0];
      document.getElementById('optionB').textContent = options[1];
      document.getElementById('optionC').textContent = options[2];
      document.getElementById('optionD').textContent = options[3];
      
      // Add back the button images that were removed when setting textContent
      document.getElementById('optionA').innerHTML = options[0] + '<img id="A_Button" src="./internalAssets/A_Button_icon.png" alt="A Button">';
      document.getElementById('optionB').innerHTML = options[1] + '<img id="B_Button" src="./internalAssets/B_Button_icon.png" alt="B Button">';
      document.getElementById('optionC').innerHTML = options[2] + '<img id="C_Button" src="./internalAssets/C_Button_icon.png" alt="C Button">';
      document.getElementById('optionD').innerHTML = options[3] + '<img id="D_Button" src="./internalAssets/D_Button_icon.png" alt="D Button">';
      
      // Show hint
      hintBubbleElement.textContent = currentQuestion.hint;
      
      // Start the timer
      startTimer(30); // 30 seconds per question
    }

    // Fetch questions from API or use sample questions
    function fetchQuestions() {
      // For testing, use sample questions
      currentQuestions = sampleQuestions;
      displayQuestion();
      
      // In a real implementation, you would fetch questions from an API
      // fetch(`/api/questions?era=${selectedEra}&difficulty=${difficulty}`)
      //   .then(response => response.json())
      //   .then(data => {
      //     currentQuestions = data;
      //     displayQuestion();
      //   })
      //   .catch(error => {
      //     console.error('Error fetching questions:', error);
      //     // Fallback to sample questions
      //     currentQuestions = sampleQuestions;
      //     displayQuestion();
      //   });
    }

    // Start fetching questions when the page is loaded
    document.addEventListener('DOMContentLoaded', fetchQuestions);
  </script>
</body>

</html>
